<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>WEARiT - Customer Details</title>    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">    <link rel="preconnect" href="https://fonts.googleapis.com">    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.min.css">    <link rel="stylesheet" href="/css/admin-navbar.css">    <link rel="stylesheet" href="/css/admin-customer-details.css"></head><body>    <%- include('../partials/navbar', {activePage: 'customer'}) %>    <main class="admin-main">        <div class="admin-content">            <% if (locals.success_msg && success_msg.length > 0) { %>                <div class="alert alert-success alert-dismissible fade show" role="alert">                    <%= success_msg %>                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>                </div>            <% } %>            <% if (locals.error_msg && error_msg.length > 0) { %>                <div class="alert alert-danger alert-dismissible fade show" role="alert">                    <%= error_msg %>                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>                </div>            <% } %>            <nav aria-label="breadcrumb" class="mb-4">                <ol class="breadcrumb">                    <li class="breadcrumb-item">                        <a href="/admin/dashboard" class="text-decoration-none">Dashboard</a>                    </li>                    <li class="breadcrumb-item">                        <a href="/admin/customer" class="text-decoration-none">Customers</a>                    </li>                    <li class="breadcrumb-item active" aria-current="page">Customer Details</li>                </ol>            </nav>            <div class="header-section mb-4">                <div>                    <h2 class="mb-1">Customer Profile</h2>                    <p class="text-muted mb-0">Detailed information about <%= user.name %></p>                </div>                <% if (user.isBlocked) { %>                    <form action="/admin/block-unblock-user/<%= user._id %>?returnTo=details" method="POST" class="toggle-form">                        <button type="submit" class="btn btn-success">                            <i class="fas fa-unlock me-2"></i>Unblock Customer                        </button>                    </form>                <% } else { %>                    <form action="/admin/block-unblock-user/<%= user._id %>?returnTo=details" method="POST" class="toggle-form">                        <button type="submit" class="btn btn-danger">                            <i class="fas fa-ban me-2"></i>Block Customer                        </button>                    </form>                <% } %>            </div>            <div class="row">                <div class="col-lg-4 mb-4">                    <div class="profile-card">                        <div class="profile-header"></div>                        <div class="d-flex flex-column align-items-center p-3">                            <img src="<%= user.profileImage || '/images/profile.png' %>" alt="<%= user.name %>" class="profile-avatar">                            <h3 class="profile-name"><%= user.name %></h3>                            <span class="mb-3">                                <% if (user.isBlocked) { %>                                    <span class="status-badge status-cancelled">                                        <i class="fas fa-ban me-1"></i>Blocked                                    </span>                                <% } else { %>                                    <span class="status-badge status-delivered">                                        <i class="fas fa-check-circle me-1"></i>Active                                    </span>                                <% } %>                            </span>                        </div>                        <div class="profile-info">                            <div class="info-label">                                <i class="fas fa-envelope"></i>                                <p class="info-title">Email Address</p>                            </div>                            <p class="info-value"><%= user.email %></p>                            <div class="info-label">                                <i class="fas fa-phone"></i>                                <p class="info-title">Phone Number</p>                            </div>                            <p class="info-value"><%= user.mobile || 'Not provided' %></p>                            <% if (user.address && user.address.length > 0) { %>                                <div class="info-label">                                    <i class="fas fa-map-marker-alt"></i>                                    <p class="info-title">Primary Address</p>                                </div>                                <p class="info-value">                                    <%= user.address[0].street %>, <%= user.address[0].city %>,                                    <%= user.address[0].state %>, <%= user.address[0].zipCode %>,                                    <%= user.address[0].country %>                                </p>                            <% } %>                            <div class="info-label">                                <i class="fas fa-calendar-alt"></i>                                <p class="info-title">Joined On</p>                            </div>                            <p class="info-value">                                <%= new Date(user.createdAt).toLocaleDateString('en-US', {                                    year: 'numeric',                                    month: 'long',                                    day: 'numeric'                                }) %>                            </p>                            <% if (user.wallet && user.wallet.transactions && user.wallet.transactions.length > 0) { %>                                <div class="info-label">                                    <i class="fas fa-exchange-alt"></i>                                    <p class="info-title">Latest Transaction</p>                                </div>                                <p class="info-value">                                    <%= new Date(user.wallet.transactions[0].date).toLocaleDateString('en-US', {                                        year: 'numeric',                                        month: 'short',                                        day: 'numeric'                                    }) %> -                                    <%= user.wallet.transactions[0].type === 'credit' ? '+' : '-' %>₹<%= user.wallet.transactions[0].amount.toFixed(2) %>                                </p>                            <% } %>                        </div>                    </div>                </div>                <div class="col-lg-8">                    <div class="row">                        <div class="col-md-4 mb-4">                            <div class="summary-card">                                <div class="summary-icon wallet-icon">                                    <i class="fas fa-wallet"></i>                                </div>                                <p class="summary-label">Wallet Balance</p>                                <h3 class="summary-value">₹<%= stats.walletBalance ? stats.walletBalance.toFixed(2) : '0.00' %></h3>                            </div>                        </div>                        <div class="col-md-4 mb-4">                            <div class="summary-card">                                <div class="summary-icon orders-icon">                                    <i class="fas fa-shopping-bag"></i>                                </div>                                <p class="summary-label">Total Orders</p>                                <h3 class="summary-value"><%= stats.totalOrders || 0 %></h3>                            </div>                        </div>                    </div>                    <div class="orders-card">                        <div class="orders-header">                            <h3 class="orders-title">Recent Orders</h3>                            <a href="/admin/customer/<%= user._id %>/orders" class="btn btn-primary">                                <i class="fas fa-list me-2"></i>View All Orders                            </a>                        </div>                        <% if (orders && orders.length > 0) { %>                            <div class="table-responsive">                                <table class="table orders-table mb-0">                                    <thead>                                        <tr>                                            <th>Order ID</th>                                            <th>Products</th>                                            <th>Total</th>                                            <th>Status</th>                                            <th>Date</th>                                            <th>Actions</th>                                        </tr>                                    </thead>                                    <tbody>                                        <% orders.forEach(order => { %>                                            <tr>                                                <td class="order-id">#<%= order.orderID %></td>                                                <td>                                                    <div class="product-info">                                                        <% if (order.products && order.products.length > 0 && order.products[0].product && order.products[0].product.images && order.products[0].product.images.length > 0) { %>                                                            <img src="<%= order.products[0].product.images[0] %>" alt="Product" class="product-img">                                                        <% } else { %>                                                            <div class="product-img d-flex align-items-center justify-content-center">                                                                <i class="fas fa-box"></i>                                                            </div>                                                        <% } %>                                                        <div>                                                            <p class="product-name">                                                                <% if (order.products && order.products.length > 0 && order.products[0].product) { %>                                                                    <%= order.products[0].product.name %>                                                                <% } else { %>                                                                    Product                                                                <% } %>                                                                <% if (order.products && order.products.length > 1) { %>                                                                    <span class="badge bg-secondary ms-2">+<%= order.products.length - 1 %> more</span>                                                                <% } %>                                                            </p>                                                        </div>                                                    </div>                                                </td>                                                <td>₹<%= order.finalAmount ? order.finalAmount.toFixed(2) : '0.00' %></td>                                                <td>                                                    <%                                                        let statusClass = '';                                                        switch(order.orderStatus) {                                                            case 'pending':                                                                statusClass = 'status-pending';                                                                break;                                                            case 'processing':                                                                statusClass = 'status-processing';                                                                break;                                                            case 'shipped':                                                                statusClass = 'status-shipped';                                                                break;                                                            case 'delivered':                                                                statusClass = 'status-delivered';                                                                break;                                                            case 'cancelled':                                                                statusClass = 'status-cancelled';                                                                break;                                                            default:                                                                statusClass = 'status-pending';                                                        }                                                    %>                                                    <span class="status-badge <%= statusClass %>">                                                        <%= order.orderStatus ? order.orderStatus.charAt(0).toUpperCase() + order.orderStatus.slice(1) : 'Pending' %>                                                    </span>                                                </td>                                                <td>                                                    <%= new Date(order.orderDate || order.createdAt).toLocaleDateString('en-US', {                                                        day: 'numeric',                                                        month: 'short',                                                        year: 'numeric'                                                    }) %>                                                </td>                                                <td>                                                    <a href="/admin/orders/<%= order._id %>" class="btn btn-sm btn-outline-primary">                                                        <i class="fas fa-eye"></i>                                                    </a>                                                </td>                                            </tr>                                        <% }); %>                                    </tbody>                                </table>                            </div>                        <% } else { %>                            <div class="empty-state">                                <i class="fas fa-shopping-cart empty-icon"></i>                                <h4 class="empty-title">No Orders Yet</h4>                                <p class="empty-text">This customer hasn't placed any orders yet.</p>                            </div>                        <% } %>                    </div>                    <% if (user.wallet && user.wallet.transactions && user.wallet.transactions.length > 0) { %>                        <div class="orders-card mt-4">                            <div class="orders-header">                                <h3 class="orders-title">Wallet Transactions</h3>                            </div>                            <div class="table-responsive">                                <table class="table orders-table mb-0">                                    <thead>                                        <tr>                                            <th>Date</th>                                            <th>Description</th>                                            <th>Type</th>                                            <th>Amount</th>                                        </tr>                                    </thead>                                    <tbody>                                        <% user.wallet.transactions.slice(0, 5).forEach(transaction => { %>                                            <tr>                                                <td>                                                    <%= new Date(transaction.date).toLocaleDateString('en-US', {                                                        day: 'numeric',                                                        month: 'short',                                                        year: 'numeric'                                                    }) %>                                                </td>                                                <td><%= transaction.description %></td>                                                <td>                                                    <span class="status-badge <%= transaction.type === 'credit' ? 'status-delivered' : 'status-cancelled' %>">                                                        <%= transaction.type === 'credit' ? 'Credit' : 'Debit' %>                                                    </span>                                                </td>                                                <td class="<%= transaction.type === 'credit' ? 'text-success' : 'text-danger' %>">                                                    <%= transaction.type === 'credit' ? '+' : '-' %>₹<%= transaction.amount.toFixed(2) %>                                                </td>                                            </tr>                                        <% }); %>                                    </tbody>                                </table>                            </div>                        </div>                    <% } %>                </div>            </div>        </div>    </main>    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.all.min.js"></script>    <script src="/js/admin-navbar.js"></script>    <script src="/js/admin-customerDetails.js"></script></body></html>