<!DOCTYPE html><html lang="en">    <head>        <meta charset="UTF-8" />        <meta name="viewport" content="width=device-width, initial-scale=1.0" />        <title>WEARiT - Update Product</title>        <link            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"            rel="stylesheet"        />        <link rel="preconnect" href="https://fonts.googleapis.com">        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">        <link            rel="stylesheet"            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"        />        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.min.css">        <link            rel="stylesheet"            href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"        />        <link rel="stylesheet" href="/css/admin-navbar.css">        <link rel="stylesheet" href="/css/admin-update-products.css">    </head>    <body>        <%- include('../partials/navbar', {activePage: 'products'}) %>        <main class="admin-main">            <div class="admin-content">                <% if (locals.success_msg && success_msg.length > 0) { %>                    <div class="alert alert-success alert-dismissible fade show" role="alert">                        <%= success_msg %>                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>                    </div>                <% } %>                <% if (locals.error_msg && error_msg.length > 0) { %>                    <div class="alert alert-danger alert-dismissible fade show" role="alert">                        <%= error_msg %>                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>                    </div>                <% } %>                <div class="mb-4">                    <h2 class="page-title">Update Product</h2>                    <nav aria-label="breadcrumb">                        <ol class="breadcrumb">                            <li class="breadcrumb-item">                                <a href="/admin/dashboard" class="text-decoration-none">Dashboard</a>                            </li>                            <li class="breadcrumb-item">                                <a href="/admin/products" class="text-decoration-none">Products</a>                            </li>                            <li class="breadcrumb-item active" aria-current="page">                                Update Product                            </li>                        </ol>                    </nav>                </div>                <form action="/admin/editproducts" method="POST" enctype="multipart/form-data" id="updateProductForm">                    <input type="hidden" name="productId" value="<%= product._id %>">                    <div class="form-card mb-4">                        <h3 class="section-title">General Information</h3>                        <div class="mb-3">                            <label for="productName" class="form-label">Product Name</label>                            <input                                type="text"                                class="form-control"                                id="productName"                                name="name"                                placeholder="Type product name here..."                                value="<%= product.name %>"                            />                            <div class="invalid-feedback" id="productNameError"></div>                        </div>                        <div class="mb-3">                            <label for="description" class="form-label">Description</label>                            <textarea                                class="form-control"                                id="description"                                name="description"                                rows="4"                            ><%= product.description %></textarea>                            <div class="invalid-feedback" id="descriptionError"></div>                        </div>                        <div class="row mb-3">                            <div class="col-md-6 mb-3 mb-md-0">                                <label for="category" class="form-label">Select Category</label>                                <select class="form-select" id="category" name="category">                                    <option value="">Select a category</option>                                    <% if (categories && categories.length > 0) { %>                                        <% categories.forEach(category => { %>                                            <%                                                let isSelected = false;                                                if (product.categoryId) {                                                    if (typeof product.categoryId === 'object' && product.categoryId._id) {                                                        isSelected = product.categoryId._id.toString() === category._id.toString();                                                    } else {                                                        isSelected = product.categoryId.toString() === category._id.toString();                                                    }                                                }                                            %>                                            <option value="<%= category._id %>" <%= isSelected ? 'selected' : '' %>>                                                <%= category.name %>                                            </option>                                        <% }); %>                                    <% } %>                                </select>                                <div class="invalid-feedback" id="categoryError"></div>                            </div>                            <div class="col-md-6 mb-3 mb-md-0">                                <label for="brand" class="form-label">Brand</label>                                <input                                    type="text"                                    class="form-control"                                    id="brand"                                    name="brand"                                    placeholder="Brand name..."                                    value="<%= product.brand || '' %>"                                />                            </div>                        </div>                        <div class="row mb-3">                            <div class="col-md-6 mb-3 mb-md-0">                                <label for="color" class="form-label">Color</label>                                <input                                    type="text"                                    class="form-control"                                    id="color"                                    name="color"                                    placeholder="Product color..."                                    value="<%= product.color || '' %>"                                />                                <div class="invalid-feedback" id="colorError"></div>                            </div>                            <div class="col-md-6 mb-3 mb-md-0">                                <label for="fabric" class="form-label">Fabric</label>                                <input                                    type="text"                                    class="form-control"                                    id="fabric"                                    name="fabric"                                    placeholder="Fabric type..."                                    value="<%= product.fabric || '' %>"                                />                                <div class="invalid-feedback" id="fabricError"></div>                            </div>                        </div>                        <div class="row mb-3">                            <div class="col-md-6 mb-3 mb-md-0">                                <label for="sku" class="form-label">SKU</label>                                <input                                    type="text"                                    class="form-control"                                    id="sku"                                    name="sku"                                    placeholder="Stock Keeping Unit..."                                    value="<%= product.sku || '' %>"                                />                            </div>                            <div class="col-md-6 mb-3 mb-md-0">                                <label for="offer" class="form-label">Offer (%)</label>                                <input                                    type="number"                                    class="form-control"                                    id="offer"                                    name="offer"                                    min="0"                                    max="99"                                    placeholder="Discount percentage..."                                    value="<%= product.offer || 0 %>"                                />                            </div>                        </div>                        <div class="mb-3">                            <label for="tags" class="form-label">Tags (comma separated)</label>                            <input                                type="text"                                class="form-control"                                id="tags"                                name="tags"                                placeholder="summer, casual, cotton..."                                value="<%= product.tags ? product.tags.join(', ') : '' %>"                            />                        </div>                    </div>                    <div class="form-card mb-4">                        <h3 class="section-title">Product Variants</h3>                        <p class="text-muted mb-3">                            Enter price and quantity for S, M, L, XL                        </p>                        <% const sizes = ["S", "M", "L", "XL"]; %>                        <% sizes.forEach((size, index) => {                            const variant = product.variants ? product.variants.find(v => v.size === size) : null;                            const price = variant ? variant.varientPrice : '';                            const quantity = variant ? variant.varientquatity : 0;                        %>                        <div class="row mb-3">                            <div class="col-md-3 mb-3 mb-md-0">                                <label class="form-label">Size</label>                                <input                                    type="text"                                    class="form-control"                                    value="<%= size %>"                                    readonly                                    name="size"                                />                            </div>                            <div class="col-md-3 mb-3 mb-md-0">                                <label class="form-label">Regular Price (â‚¹)</label>                                <input                                    type="number"                                    class="form-control"                                    name="varientPrice[<%= size %>]"                                    min="0"                                    step="0.01"                                    value="<%= price %>"                                />                                <div class="invalid-feedback" id="priceError<%= index %>"></div>                            </div>                            <div class="col-md-3">                                <label class="form-label">Quantity</label>                                <input                                    type="number"                                    class="form-control"                                    name="sizes[<%= size %>]"                                    min="0"                                    value="<%= quantity %>"                                />                                <div class="invalid-feedback" id="quantityError<%= index %>"></div>                            </div>                        </div>                        <% }) %>                    </div>                    <div class="image-upload-section mb-4">                        <h3 class="image-upload-title">PRODUCT IMAGES</h3>                        <div class="mb-4">                            <p class="main-photo-label">Main Photo (Required)</p>                            <div class="position-relative">                                <div                                    class="image-upload-area"                                    id="mainPhotoUpload"                                    <% if (product.images && product.images.length > 0 && product.images[0].url) { %>                                    style="background-image: url('<%= product.images[0].url %>'); background-size: cover; background-position: center;"                                    <% } %>                                >                                    <% if (!product.images || product.images.length === 0 || !product.images[0].url) { %>                                        <i class="fas fa-image upload-icon"></i>                                        <p class="upload-text">                                            Drag and drop image here, or click to add image                                        </p>                                        <button type="button" class="btn-upload" id="mainImageBtn">                                            Add Image                                        </button>                                    <% } %>                                </div>                                <input type="file" name="mainImage" id="mainImage" class="d-none" accept="image/*">                                <% if (product.images && product.images.length > 0 && product.images[0].url) { %>                                    <input type="hidden" name="oldMainImage" value="<%= product.images[0].url %>">                                    <div class="remove-image-btn" id="removeMainImage">                                        <i class="fas fa-times"></i>                                    </div>                                <% } else { %>                                    <div class="remove-image-btn d-none" id="removeMainImage">                                        <i class="fas fa-times"></i>                                    </div>                                <% } %>                            </div>                            <div class="invalid-feedback d-block" id="mainImageError"></div>                            <small class="form-text">Recommended size: 800x1000 pixels. Max file size: 2MB.</small>                        </div>                        <div class="additional-photos">                            <p class="additional-photos-label">Additional Photos (Optional)</p>                            <div class="row">                                <% for(let i = 0; i < 3; i++) { %>                                    <div class="col-md-4 mb-3 mb-md-0">                                        <div class="position-relative">                                            <div                                                class="image-upload-area"                                                id="additionalPhoto<%= i+1 %>Container"                                                <% if (product.images && product.images[i+1] && product.images[i+1].url) { %>                                                style="background-image: url('<%= product.images[i+1].url %>'); background-size: cover; background-position: center;"                                                <% } %>                                            >                                                <% if (!product.images || !product.images[i+1] || !product.images[i+1].url) { %>                                                    <i class="fas fa-image upload-icon"></i>                                                    <p class="upload-text">                                                        Drag and drop image here, or click to add image                                                    </p>                                                    <button type="button" class="btn-upload" id="additionalImage<%= i+1 %>Btn">                                                        Add Image                                                    </button>                                                <% } %>                                            </div>                                            <input type="file" name="additionalImage<%= i+1 %>" id="additionalImage<%= i+1 %>" class="d-none" accept="image/*">                                            <% if (product.images && product.images[i+1] && product.images[i+1].url) { %>                                                <input type="hidden" name="oldAdditionalImage<%= i+1 %>" value="<%= product.images[i+1].url %>">                                                <div class="remove-image-btn" id="removeAdditionalImage<%= i+1 %>">                                                    <i class="fas fa-times"></i>                                                </div>                                            <% } else { %>                                                <div class="remove-image-btn d-none" id="removeAdditionalImage<%= i+1 %>">                                                    <i class="fas fa-times"></i>                                                </div>                                            <% } %>                                        </div>                                    </div>                                <% } %>                            </div>                        </div>                    </div>                    <div class="d-flex justify-content-center mt-5 mb-4">                        <a href="/admin/products" class="btn btn-cancel me-3">CANCEL</a>                        <button type="submit" class="btn btn-add">UPDATE PRODUCT</button>                    </div>                </form>            </div>        </main>        <div class="modal fade" id="imageCropperModal" tabindex="-1" aria-labelledby="imageCropperModalLabel" aria-hidden="true">            <div class="modal-dialog modal-lg">                <div class="modal-content">                    <div class="modal-header">                        <h5 class="modal-title" id="imageCropperModalLabel">Crop Image</h5>                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>                    </div>                    <div class="modal-body">                        <div class="img-container">                            <img id="cropperImage" src="/placeholder.svg" alt="Image to crop">                        </div>                        <div class="crop-controls mt-3">                            <div class="btn-group me-2">                                <button type="button" class="btn btn-outline-secondary" id="rotateLeftBtn">                                    <i class="fas fa-undo"></i>                                </button>                                <button type="button" class="btn btn-outline-secondary" id="rotateRightBtn">                                    <i class="fas fa-redo"></i>                                </button>                            </div>                            <div class="btn-group me-2">                                <button type="button" class="btn btn-outline-secondary" id="zoomInBtn">                                    <i class="fas fa-search-plus"></i>                                </button>                                <button type="button" class="btn btn-outline-secondary" id="zoomOutBtn">                                    <i class="fas fa-search-minus"></i>                                </button>                            </div>                            <button type="button" class="btn btn-outline-secondary" id="resetBtn">                                <i class="fas fa-sync-alt"></i> Reset                            </button>                        </div>                    </div>                    <div class="modal-footer">                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>                        <button type="button" class="btn btn-primary" id="cropImageBtn">Crop & Save</button>                    </div>                </div>            </div>        </div>        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.all.min.js"></script>        <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>        <script src="/js/admin-navbar.js"></script>        <script src="/js/admin-updateProducts.js"></script>    </body></html>