<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>WEARiT - Change Password</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.min.css"
        />
        <link rel="stylesheet" href="/css/admin-navbar.css" />
        <link rel="stylesheet" href="/css/admin-change-password.css" />
    </head>
    <body>
        <%- include('../partials/navbar', {activePage: 'account'}) %>

        <main class="admin-main">
            <div class="admin-content">
                <div
                    class="d-flex justify-content-between align-items-center mb-4"
                >
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a
                                    href="/admin/dashboard"
                                    class="text-decoration-none"
                                    >Dashboard</a
                                >
                            </li>
                            <li class="breadcrumb-item">
                                <a
                                    href="/admin/account"
                                    class="text-decoration-none"
                                    >Account</a
                                >
                            </li>
                            <li
                                class="breadcrumb-item active"
                                aria-current="page"
                            >
                                Change Password
                            </li>
                        </ol>
                    </nav>
                </div>

                <% if (locals.success_msg && success_msg.length > 0) { %>
                <div
                    class="alert alert-success alert-dismissible fade show"
                    role="alert"
                >
                    <%= success_msg %>
                    <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="alert"
                        aria-label="Close"
                    ></button>
                </div>
                <% } %> <% if (locals.error_msg && error_msg.length > 0) { %>
                <div
                    class="alert alert-danger alert-dismissible fade show"
                    role="alert"
                >
                    <%= error_msg %>
                    <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="alert"
                        aria-label="Close"
                    ></button>
                </div>
                <% } %>

                <div class="password-card">
                    <h2 class="password-title">Change Password</h2>

                    <form
                        action="/admin/changepassword"
                        method="POST"
                        id="changePasswordForm"
                    >
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label"
                                >Enter Current Password</label
                            >
                            <input
                                type="password"
                                class="form-control"
                                id="currentPassword"
                                name="currentPassword"
                                required
                            />
                        </div>

                        <div class="mb-3">
                            <label for="newPassword" class="form-label"
                                >Enter New Password</label
                            >
                            <input
                                type="password"
                                class="form-control"
                                id="newPassword"
                                name="newPassword"
                                required
                            />
                            <small class="form-text text-muted"
                                >Password must be at least 8 characters long and
                                include at least one uppercase letter, one
                                lowercase letter, and one number.</small
                            >
                        </div>

                        <div class="mb-4">
                            <label for="confirmPassword" class="form-label"
                                >Confirm New Password</label
                            >
                            <input
                                type="password"
                                class="form-control"
                                id="confirmPassword"
                                name="confirmPassword"
                                required
                            />
                        </div>

                        <div class="update-btn-container">
                            <button type="submit" class="btn btn-update">
                                Update Password
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.all.min.js"></script>
        <script src="/js/admin-navbar.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                try {
                    if (
                        typeof locals !== "undefined" &&
                        locals.success_msg &&
                        success_msg.length > 0
                    ) {
                        Swal.fire({
                            icon: "success",
                            title: "Success",
                            text: success_msg,
                            confirmButtonColor: "#0d6efd",
                        });
                    }

                    if (
                        typeof locals !== "undefined" &&
                        locals.error_msg &&
                        error_msg.length > 0
                    ) {
                        Swal.fire({
                            icon: "error",
                            title: "Error",
                            text: error_msg,
                            confirmButtonColor: "#0d6efd",
                        });
                    }
                } catch (e) {
                    console.log("Flash message check error:", e);
                }

                const form = document.getElementById("changePasswordForm");
                if (form) {
                    form.addEventListener("submit", function (e) {
                        const currentPassword =
                            document.getElementById("currentPassword").value;
                        const newPassword =
                            document.getElementById("newPassword").value;
                        const confirmPassword =
                            document.getElementById("confirmPassword").value;
                        if (
                            !currentPassword ||
                            !newPassword ||
                            !confirmPassword
                        ) {
                            e.preventDefault();
                            Swal.fire({
                                icon: "error",
                                title: "Validation Error",
                                text: "All fields are required",
                                confirmButtonColor: "#0d6efd",
                            });
                            return;
                        }
                        const passwordRegex =
                            /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;
                        if (!passwordRegex.test(newPassword)) {
                            e.preventDefault();
                            Swal.fire({
                                icon: "error",
                                title: "Validation Error",
                                text: "Password must be at least 8 characters long and include at least one uppercase letter, one lowercase letter, and one number",
                                confirmButtonColor: "#0d6efd",
                            });
                            return;
                        }

                        if (newPassword !== confirmPassword) {
                            e.preventDefault();
                            Swal.fire({
                                icon: "error",
                                title: "Validation Error",
                                text: "New password and confirm password do not match",
                                confirmButtonColor: "#0d6efd",
                            });
                            return;
                        }
                    });
                }
            });
        </script>
    </body>
</html>
