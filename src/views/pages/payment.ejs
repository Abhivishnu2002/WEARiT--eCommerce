<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Payment - WEARIT</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/header.css" />
  <link rel="stylesheet" href="/css/footer.css" />
  <link rel="stylesheet" href="/css/checkout.css" />
</head>
<body>
  <%- include('../partials/header') %>
  <div class="checkout-container">
    <div class="row">
      <div class="col-lg-8">
        <div class="checkout-content mb-4">
          <div class="checkout-header">
            <h2 class="checkout-title">
              Payment Method
            </h2>
          </div>
          <form id="payment-form" action="/place-order" method="POST">
            <input type="hidden" name="addressId" value="<%= addressId %>" />

            <div class="mb-4">
              <p class="mb-3">Select any payment methods</p>

              <div class="payment-method-card">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="paymentMethod" id="card" value="card" checked />
                  <label class="form-check-label d-flex justify-content-between align-items-center" for="card">
                    <span>Debit Card / Credit Card</span>
                    <div class="payment-icons">
                      <img src="/images/payment/rupay.png" alt="RuPay" height="25" />
                      <img src="/images/payment/visa.png" alt="Visa" height="25" />
                      <img src="/images/payment/mastercard.png" alt="Mastercard" height="25" />
                      <img src="/images/payment/freecharge.png" alt="Freecharge" height="25" />
                    </div>
                  </label>
                </div>
              </div>

              <div class="payment-method-card">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="paymentMethod" id="bank" value="bank" />
                  <label class="form-check-label" for="bank">
                    Bank
                  </label>
                </div>
              </div>

              <div class="payment-method-card">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="paymentMethod" id="upi" value="upi" />
                  <label class="form-check-label" for="upi">
                    UPI Method
                  </label>
                </div>
              </div>

              <div class="payment-method-card">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="COD" />
                  <label class="form-check-label" for="cod">
                    Cash on delivery
                  </label>
                </div>
              </div>

              <div class="payment-method-card">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="paymentMethod" id="wallet" value="wallet" />
                  <label class="form-check-label" for="wallet">
                    Wallet
                  </label>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-between mt-4">
              <a href="/checkout" class="btn btn-outline">Back to Address</a>
              <button type="submit" class="btn btn-checkout">
                Place Order
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="order-summary">
          <div class="order-summary-header">
            <h5 class="order-summary-title">ORDER SUMMARY</h5>
          </div>
          <div class="order-summary-content">
            <% if (cart && cart.products) { %> 
              <% cart.products.forEach(item => { %>
            <div class="order-item">
              <% const variant = item.product.variants.find(v=> v.size === item.size); 
                 const mainImage = item.product.images.find(img => img.isMain) || item.product.images[0]; %>
              <div class="order-item-image">
                <img src="<%= mainImage ? mainImage.thumbnail : '/images/placeholder.jpg' %>" alt="<%= item.product.name %>" />
              </div>
              <div class="order-item-details">
                <div class="order-item-title">
                  <%= item.product.name %>
                </div>
                <div class="order-item-meta">
                  Qty: <%= item.quantity %> | Size: <%= item.size %>
                </div>
              </div>
              <div class="order-item-price">
                <% if (variant) { %> <% if (variant.varientPrice !== variant.salePrice){ %>
                <div class="price-original">
                  ₹<%= variant.varientPrice %>
                </div>
                <div class="price-final">
                  ₹<%= variant.salePrice %>
                </div>
                <% } else { %>
                <div class="price-final">
                  ₹<%= variant.salePrice %>
                </div>
                <% } %> <% } %>
              </div>
            </div>
            <% }); %>

            <div class="order-summary-row">
              <span>Subtotal:</span>
              <span>₹<%= totals.subtotal.toFixed(2) %></span>
            </div>

            <div class="order-summary-row">
              <span>Discount:</span>
              <span class="discount-text">-₹<%= totals.discount.toFixed(2) %></span>
            </div>

            <div class="order-summary-row">
              <span>Tax (5%):</span>
              <span>₹<%= totals.tax.toFixed(2) %></span>
            </div>

            <div class="order-summary-row">
              <span>Shipping:</span>
              <% if (totals.shipping === 0) { %>
              <span class="discount-text">Free</span>
              <% } else { %>
              <span>₹<%= totals.shipping.toFixed(2) %></span>
              <% } %>
            </div>

            <% if (couponDiscount && couponDiscount > 0) { %>
            <div class="order-summary-row">
              <span>Coupon discount:</span>
              <span class="discount-text">-₹<%= couponDiscount.toFixed(2) %></span>
            </div>
            <% } %>

            <div class="order-summary-row total">
              <span>Total:</span>
              <span>₹<%= totals.finalAmount %></span>
            </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%- include('../partials/footer') %>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/js/header.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const paymentMethodCards = document.querySelectorAll(".payment-method-card");

      paymentMethodCards.forEach((card) => {
        card.addEventListener("click", function() {
          const radio = this.querySelector('input[type="radio"]');
          if (radio) {
            radio.checked = true;
          }
        });
      });
    });
  </script>
</body>

</html>