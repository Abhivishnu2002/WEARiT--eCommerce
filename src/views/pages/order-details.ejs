<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Order Details - WEARiT</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="/css/header.css" />
        <link rel="stylesheet" href="/css/footer.css" />
        <link rel="stylesheet" href="/css/navbar.css" />
        <link rel="stylesheet" href="/css/order-details.css" />
    </head>
    <body>
        <%- include('../partials/header') %>
        <div class="container my-4">
            <div class="breadcrumb-container">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="/profile">Profile</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="/profile/orders">orders</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">
                            order details
                        </li>
                    </ol>
                </nav>
            </div>

            <div class="row">
                <div class="col-lg-3 mb-4">
                    <%- include('../partials/navbar', { activePage: 'orders',
                    wishlistCount: wishlistCount || 0 }) %>
                </div>
                <div class="col-lg-9">
                    <div class="order-details-card">
                        <h2 class="order-details-title">Order Details</h2>
                        <div class="row mt-4">
                            <div class="col-md-4 mb-4">
                                <div class="product-image-container">
                                    <% if (order.products && order.products.length > 0 && order.products[0].product && order.products[0].product.images && order.products[0].product.images.length > 0) { %>
                                        <img
                                            src="<%= order.products[0].product.images[0].url %>"
                                            alt="<%= order.products[0].product.name %>"
                                            class="img-fluid product-image"
                                        />
                                    <% } else { %>
                                        <img
                                            src="/images/placeholder.jpg"
                                            alt="Product"
                                            class="img-fluid product-image"
                                        />
                                    <% } %>
                                </div>
                                <div class="order-status mt-3">
                                    <p>
                                        Status :
                                        <span
                                            class="<%= order.status ? order.status.toLowerCase() : 'pending' %>"
                                            ><%= order.status || 'Pending' %></span
                                        >
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <div class="info-section">
                                            <h4>Shipping Address</h4>
                                            <div class="address-details">
                                                <% if (order.address) { %>
                                                <p>
                                                    <strong
                                                        >Customer Name</strong
                                                    >
                                                </p>
                                                <p><%= order.address.name %></p>

                                                <p>
                                                    <strong>Address</strong>
                                                </p>
                                                <p>
                                                    <%= order.address.address || order.address.addressLine1 %>
                                                </p>

                                                <p>
                                                    <strong
                                                        >City, State</strong
                                                    >
                                                </p>
                                                <p>
                                                    <%= order.address.city %>,
                                                    <%= order.address.state %>
                                                </p>

                                                <p>
                                                    <strong
                                                        >Pin Code</strong
                                                    >
                                                </p>
                                                <p>
                                                    <%= order.address.pincode %>
                                                </p>

                                                <p>
                                                    <strong
                                                        >Contact Number</strong
                                                    >
                                                </p>
                                                <p>
                                                    <%= order.address.mobile %>
                                                </p>
                                                <% } else { %>
                                                <p>Address information not available</p>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <div class="info-section">
                                            <h4>Payment Method</h4>
                                            <p>
                                                <%= (order.paymentMethod || order.paymentMentod) === 'COD' ? 'Cash on Delivery' : 'Online Payment' %>
                                            </p>
                                        </div>
                                        <div class="info-section mt-4">
                                            <h4>Order Summary</h4>
                                            <div class="order-summary">
                                                <div class="summary-row">
                                                    <span>Items Total</span>
                                                    <span
                                                        >: ₹<%=
                                                        order.itemsTotal.toFixed(2)
                                                        %></span
                                                    >
                                                </div>
                                                <% if (order.discount > 0) { %>
                                                <div class="summary-row">
                                                    <span>Discount</span>
                                                    <span
                                                        >: ₹<%=
                                                        order.discount.toFixed(2)
                                                        %></span
                                                    >
                                                </div>
                                                <% } %>
                                                <div
                                                    class="summary-row grand-total"
                                                >
                                                    <span>Grand Total</span>
                                                    <span
                                                        >: ₹<%=
                                                        order.grandTotal.toFixed(2)
                                                        %></span
                                                    >
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="action-buttons mt-3">
                                    <% if (!order.status || (order.status.toLowerCase() !== 'delivered' && order.status.toLowerCase() !== 'cancelled' && order.status.toLowerCase() !== 'returned' && order.status.toLowerCase() !== 'return pending')) { %>
                                    <button
                                        class="btn btn-danger cancel-order-btn"
                                        data-order-id="<%= order._id %>"
                                    >
                                        Cancel Order
                                    </button>
                                    <% } %>
                                    
                                    <% if (order.status && order.status.toLowerCase() === 'delivered') { %>
                                    <button
                                        class="btn btn-warning return-order-btn"
                                        data-order-id="<%= order._id %>"
                                    >
                                        Return Order
                                    </button>
                                    <% } %>
                                    
                                    <a
                                        href="/orders/<%= order._id %>/track"
                                        class="btn btn-dark track-order-btn"
                                    >
                                        Track Order
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <%- include('../partials/footer') %>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="/js/order-details.js"></script>
    </body>
</html>
